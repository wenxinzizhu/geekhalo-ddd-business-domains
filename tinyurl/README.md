建库脚本：
```
CREATE SCHEMA db_tiny_url;
```
# 系统介绍
短链服务，主要用于将一个长链接转化为一个短链接，用户在访问短链的时候，直接跳转到长链地址。

什么是短链：
> 就是把普通网址，转换成比较短的网址。比如：http://t.cn/RlB2PdD 这种，在微博这些限制字数的应用里。好处不言而喻。短、字符少、美观、便于发布、传播。

核心流程：
1. 短链生成流程
    1. 为长链 URL 分配一个 ID （通常为 Number 类型）
    2. 保存 ID 与 URL 的映射关系
    3. 将 ID 进行编码，使其更短，返回给业务系统
2. 短链访问流程
    1. 提取编码后的 ID，对其进行解码，获取最终 ID
    2. 根据 ID 获取映射的 URL 信息
    3. 判断 URL 状态是否可以，如果可以，返回 URL，如果不可用，返回提示信息

短链系统几大应用场景：
1. 每个用户收到不同的链接 链接数量大，每个链接访问频次比较低
2. 每个目标群体收到相同链接 链接数量较小，每个链接访问频次较高
3. 几乎全用户收到相同链接 链接数量小，每个链接访问频次极高

链接目标人群 | 场景 | 链接数量 | 单链接访问频次 | 系统需求
---|---|---|---|---
单个用户 | 用户拉回和跟踪 | 极大 | 很低 | 极高写入，低访问
单个群体 | 母婴活动，对妈妈群体进行拉回 | 大 | 高 | 高写入，高访问  
全站用户 | 新年活动，对全站用户进行来回 | 小 | 极高 | 低写入，极高访问


组件 | 作用 
---|---|
Number Generator | 生成不重复的 Number
Number Encoder   | 对 Number 进行编解码
URL Repository   | 存储 Number 与 URL 的关系


Number Generator | 1 | 2| 5 | 10 | 20 
---|---|---|---|---|---
DBBasedSingleIdNumberGenerator|733.944946/s|934.972656/s|843.810669/s|681.356750/s|706.022766/s
RedisBasedSingleIdNumberGenerator|8561.643555/s|26178.011719/s|38138.824219/s|42052.144531/s|40395.878906/s
DBBasedBatchNumberGenerator|133333.328125/s|134228.187500/s|165562.906250/s|188323.906250/s|222469.406250/s
RedisBasedBatchNumberGenerator|434782.625000/s|540540.500000/s|609756.125000/s|671140.937500/s|754717.000000/s


Repository | 1 | 2| 5 | 10 | 20 
---|---|---|---|---|---
DBBasedTinyUrlRepository|821.018066/s|1883.239136/s|3843.197510/s|5861.664551/s|5458.515137/s
RedisCacheBasedTinyUrlRepository|4629.629395/s|14084.506836/s|40983.609375/s|64102.562500/s|83682.007813/s
LocalCacheBasedTinyUrlRepository|500000.000000/s|1000000.000000/s|2500000.000000/s|5000000.000000/s|6666666.500000/s

核心组件：



写优化：
1. 单条入库
2. 批量入库
3. 异步入库

读优化：
1. 数据库读取
2. Redis 缓存读取
3. Local Cache 读取

ID 生成优化：
1. 基于 MySQL，单 ID 生成
2. 基于 MySQL，批量 ID 生成
3. 基于 Redis，单 ID 生成
4. 基于 Redis，批量 ID 生成

其他：
Local Cache 一致性：
1. 基于过期时间
2. 基于订阅广播


